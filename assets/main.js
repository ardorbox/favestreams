var api_accept="application/vnd.twitchtv.v5+json",api_client_id="kimne78kx3ncx6brgo4mv6wki5h1ko",fav_id_arr=JSON.parse(localStorage.getItem("fav_id_arr"));function getBookmark(){$("#favList").html('<i id="bookmarkSpinner"></i>');var a=JSON.parse(localStorage.getItem("fav_id_arr")),e=a.length;0!=e?$.ajax({url:"https://api.twitch.tv/kraken/users?id="+a.join(","),method:"GET",cache:!1,dataType:"json",headers:{Accept:api_accept,"Client-ID":api_client_id}}).done(function(t){for(var i=t.users,r="",n=0;n<e;n++){var s=i.findIndex(e=>e._id==a[n]);if(!(s<0)){var l=i[s];r+='<div class="favStreamer w3-animate-opacity-fast">',r+='<div class="favStreamerLeft">',r+='<img src="'+l.logo+'">',r+='<a href="https://www.twitch.tv/'+l.name+'" target="_blank" title="'+l.display_name+" ("+l.name+')" data-name="'+l.name+'">'+l.display_name+" ("+l.name+")</a>",r+="</div>",r+='<div class="favStreamerRight">',r+='<a class="streamerDelBtn" data-id="'+l._id+'" data-display-name="'+l.display_name+'" data-name="'+l.name+'">',r+='<i class="fa fa-minus-square"></i>',r+="</a>",r+="</div>",r+="</div>"}}$("#favList").html(r)}).fail(function(a){$("#favList").empty(),alert("Twitch API Error: "+a.responseJSON.status+" "+a.responseJSON.error)}):$("#favList").html('<div class="favListMessage">등록된 채널이 없습니다.<br>채널을 등록해 주세요.</div>')}function getStreams(){$("#loadingSpinner").fadeIn(300),$.ajax({url:"https://api.twitch.tv/kraken/streams?limit=100&channel="+fav_id_arr.join(","),method:"GET",cache:!1,dataType:"json",headers:{Accept:api_accept,"Client-ID":api_client_id}}).done(function(a){var e=a.streams,t=e.length,i="";if(0!=t){for(var r=0;r<t;r++){var n=e[r];i+='<div class="w3-col l3 m6 w3-margin-bottom">',i+='<div class="w3-card">',i+='<div class="w3-display-container clipThumbnail">',i+='<a href="'+n.channel.url+'">',i+='<img src="assets/default_thumb.gif">',i+='<img src="'+n.preview.large.replace("640x360","440x248")+'" class="clipThumbImg">',i+="</a>",i+="<div>",i+="시청자 "+addComma(n.viewers)+'<span style="padding-left:2px">명</span>',i+="</div>",i+='<a class="closeStream">',i+='<i class="fa fa-times"></i>',i+="</a>",i+="</div>",i+='<div class="w3-container clipInfo">',i+='<div class="w3-col" style="width:50px">',i+='<img class="profileImg" src="'+n.channel.logo+'" alt="프사">',i+="</div>",i+='<div class="w3-rest">',i+='<div class="clipSubject">',i+='<a href="'+n.channel.url+'" title="'+checkTitle(n.channel.status)+'">'+checkTitle(n.channel.status)+"</a>",i+="</div>",i+='<div class="clipCategory">',i+='<a href="https://www.twitch.tv/'+n.channel.name+'/videos" title="'+n.channel.display_name+" ("+n.channel.name+')">'+n.channel.display_name+" ("+n.channel.name+")</a>",i+="</div>",i+='<div class="clipCategory">',i+='<a href="https://www.twitch.tv/directory/game/'+checkCategory(n.game)+'" title="'+checkCategory(n.game)+'">'+checkCategory(n.game)+"</a>",i+="</div>",i+="</div>",i+="</div>",i+="</div>",i+="</div>"}$("#clipWrap").html(i)}else $("#clipWrap").html('<div class="clipWrapMessage">생방송 중인 채널 없음</div>')}).fail(function(a){alert("Twitch API Error: "+a.responseJSON.status+" "+a.responseJSON.error)}).always(function(){$("#loadingSpinner").fadeOut(300)})}function addComma(a){return Number(a).toLocaleString("en")}function checkTitle(a){return a?""==a.trim()&&(a="&nbsp;"):a="Untitled Broadcast",a}function checkCategory(a){return a||(a="No Category"),a}void 0===fav_id_arr||null==fav_id_arr?(localStorage.setItem("fav_id_arr",JSON.stringify([])),$("#clipWrap").html('<div class="clipWrapMessage">설정에서 채널을 등록해 주세요</div>')):0==fav_id_arr.length?$("#clipWrap").html('<div class="clipWrapMessage">설정에서 채널을 등록해 주세요</div>'):getStreams(),$("#settingBtn").on("click",function(a){a.preventDefault(),getBookmark(),$("#overlay").show(),$("#settingModal").show()}),$("#overlay, #closeSettingModal").on("click",function(a){a.preventDefault(),$("#overlay").hide(),$("#settingModal").hide()}),$("#regForm").on("submit",function(a){if(a.preventDefault(),JSON.parse(localStorage.getItem("fav_id_arr")).length>=100)alert("최대 100개의 채널까지 등록가능합니다.");else{var e=$("#streamerId").val().replace(/^,/,"").replace(/,$/,"");$.ajax({url:"https://api.twitch.tv/kraken/users?login="+e,method:"GET",cache:!1,dataType:"json",headers:{Accept:api_accept,"Client-ID":api_client_id}}).done(function(a){if(a._total<1)alert("입력한 채널이 존재하지 않습니다.");else{var e=JSON.parse(localStorage.getItem("fav_id_arr"));0==e.length&&$("#favList").empty();for(var t=a.users,i=t.length,r="",n=0;n<i;n++){var s=t[n];e.indexOf(s._id)>-1?alert(s.display_name+"("+s.name+") 채널은 이미 등록되어 있습니다."):(r+='<div class="favStreamer slideDown">',r+='<div class="favStreamerLeft">',r+='<img src="'+s.logo+'">',r+='<a href="https://www.twitch.tv/'+s.name+'" target="_blank" title="'+s.display_name+" ("+s.name+')" data-name="'+s.name+'">'+s.display_name+" ("+s.name+")</a>",r+="</div>",r+='<div class="favStreamerRight">',r+='<a class="streamerDelBtn" data-id="'+s._id+'" data-display-name="'+s.display_name+'" data-name="'+s.name+'">',r+='<i class="fa fa-minus-square"></i>',r+="</a>",r+="</div>",r+="</div>",e.unshift(s._id))}$("#favList").prepend(r),$("#streamerId").val(""),localStorage.setItem("fav_id_arr",JSON.stringify(e))}}).fail(function(a){alert("Twitch API Error: "+a.responseJSON.status+" "+a.responseJSON.error)})}}),$("#favList").on("click",".streamerDelBtn",function(a){var e=$(this),t=e.attr("data-id"),i=e.attr("data-display-name"),r=e.attr("data-name");if(confirm(i+"("+r+") 채널을 삭제하시겠습니까?")){var n=e.parent().parent();n.addClass("fadeOutFast"),setTimeout(function(){n.remove()},400);var s=JSON.parse(localStorage.getItem("fav_id_arr")),l=s.indexOf(t);l>-1&&(s.splice(l,1),localStorage.setItem("fav_id_arr",JSON.stringify(s)))}}),$("#helpBtn").on("click",function(a){alert('[ 도움말 ]\n최대 100개의 채널까지 등록 가능합니다.\n아이디 입력은 쉼표로 구분해서 한번에 여러개 입력 가능합니다.\nex) twitch,faker,lck\n\n이 설정들은 브라우저에 저장되는 데이터로 인터넷 사용기록을 삭제하면 날아갑니다.\n다른 브라우저에서 사용할때는 옆의 "등록아이디 리스트 복사" 버튼으로 복사한 값을 옮겨서 입력할 수 있습니다.')}),$("#copyBtn").on("click",function(a){var e="";if($("#favList .favStreamerLeft a").each(function(a,t){e+=$(this).attr("data-name")+","}),e=e.replace(/^,/,"").replace(/,$/,"")){var t,i=document.getElementById("idListArea");i.innerHTML=e,i.select(),i.setSelectionRange(0,99999);try{t=document.execCommand("copy")}catch(a){t=!1}t?alert("[복사완료]\n"+e):alert("복사를 지원하지 않는\n브라우저 입니다."),i.innerHTML=""}else alert("등록된 채널이 없습니다")}),$("#resetBtn").on("click",function(a){confirm("등록한 모든 채널이 삭제됩니다.\n정말 초기화 하시겠습니까?")&&($("#favList").empty(),localStorage.setItem("fav_id_arr",JSON.stringify([])))}),$("#clipWrap").on("click",".closeStream",function(a){$(this).parent().parent().parent().remove()});
